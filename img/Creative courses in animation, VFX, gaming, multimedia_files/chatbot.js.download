(function($){jQuery(document).ready(function(){window.addEventListener('load',()=>{sessionStorage.removeItem('chat_init');});jQuery('.chat-icon').on('click',function(){$('.chat').fadeIn(500);$('.chat-icon').fadeOut(500);let chat_init_val=window.sessionStorage.getItem("chat_init")
console.log("chat_init_val",chat_init_val)
if(chat_init_val===null){window.sessionStorage.setItem('chat_init',1)
$('#chatbot-container').append('<div id="out_text_0" style="margin-right:30%" class="chat-bot-message">How may I assist you?</div>');}})
jQuery('.chat-minimize').on('click',function(){$('.chat').fadeOut(500);$('.chat-icon').fadeIn(500);})
jQuery('.chat-close').on('click',function(){Object.keys(sessionStorage).forEach((key)=>{if(key.startsWith('input_text_')){sessionStorage.removeItem(key);}});Object.keys(sessionStorage).forEach((key)=>{if(key.startsWith('out_text_')){sessionStorage.removeItem(key);}});$('.chat').fadeOut(500);$('.chat-icon').fadeIn(500);$('#chatbot-container').html('');})
var socket=new WebSocket('wss://8782ktceza.execute-api.ap-south-1.amazonaws.com/prod/');socket.onopen=function(event){console.log('Connected to WebSocket server');socket.send(JSON.stringify({message:'Hello WebSocket Server'}));};let flag=0;let response="";jQuery('#chatbot-input').on('keypress',function(e){if(e.which==13){var userInput=$(this).val();if(userInput!==null&&userInput!==undefined&&userInput!==''){handleAction(userInput);}
$(this).val('');}});jQuery('#request_submit').on('click',function(e){var userInput=$('#chatbot-input').val();if(userInput!==null&&userInput!==undefined&&userInput!==''){handleAction(userInput);}
$('#chatbot-input').val('');});function handleAction(userInput){console.log('Action triggered by keypress or click!');flag=0;const currentDateTime=new Date();const timestamp=currentDateTime.getTime();const payload=JSON.stringify({action:"sendmessage",message:userInput,});console.log("payload",payload)
$('#chatbot-container').append('<div id="input_text_'+timestamp+'" class="user-bot-message">'+userInput+'</div>');$('#chatbot-container').append('<div id="out_text_'+timestamp+'" class="chat-bot-message"><div class="chat-spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');$('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);const updatedMessage=getResponseMessages(userInput,payload,timestamp);$(this).val('');}
function getResponseMessages(userInput,payload,timestamp){window.sessionStorage.setItem('input_text_'+timestamp,userInput)
socket.send(payload);socket.onmessage=async function(event){var message=event.data;console.log("event",typeof message);let botMessageRef="";let responseData=JSON.parse(event.data)?.data;let responseId=JSON.parse(event.data)?.session_id;console.log("responseId",responseId)
console.log("responseData",responseData)
if(responseData=="<empty string>"){flag=0;}
if(flag==0){console.log("flag",flag);$('#out_text_'+timestamp).html('');}
if(responseData==="##CONVERSATION_ENDED##"){flag=2;$('.chat-bot-message').append('</div>');console.log("Current response ended, ready for new input.");botMessageRef="";}else if(responseData&&responseData!="<empty string>"){flag=1;const updatedMessage=await updateMessages(responseData,timestamp);}else{flag=3;console.log("Data key not found in response:",responseData);}};socket.onerror=function(error){console.log("WebSocket error: "+error.message);};}
let messages=[];const botMessageRef={current:"Hello from the bot!"};function updateMessages(responseData,timestamp){console.log("updatedMessage",responseData);$('#out_text_'+timestamp).append(responseData.replace(/\n/g,'<br>'));$('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);console.log("Updated bot message: ",responseData);}});})(jQuery);